<!DOCTYPE html>
<html lang="ps">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خیاطی سیسټم - لیست</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: #c7b5ec;
        }

        .near-delivery {
            background-color: #dea584;
            border-left: 4px solid #ff4d4f;
        }

        .alert-icon {
            color: #ff4d4f;
            font-weight: bold;
            margin-left: 3px;
        }

        .card-title {
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="container py-5">
        <h2 class="text-center mb-4 ">عزیز خیاطی اورخت پلورنڅی ته ښه راغلاست</h2>

        <div class="d-flex justify-content-between mb-4 flex-wrap">
            <div class="position-relative mb-2 w-50">
                <input type="text" id="searchInput" class="form-control" placeholder="د مشتریانو نوم یا شمیره ولټوه">
            </div>
            <div class="mb-2">
                <button class="btn btn-danger me-2" id="clearStorageBtn">ټول حذف کړئ</button>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#customerModal">نوی مشتری اضافه
                    کړئ</button>
            </div>
        </div>

        <div class="card shadow-sm d-none d-md-block">
            <div class="card-body p-1">
                <table class="table table-hover mb-1">
                    <thead class="table-success">
                        <tr>
                            <th>نوم</th>
                            <th>شمیره</th>
                            <th>راوړلو تاریخ</th>
                            <th>قیمت</th>
                            <th>معلومات</th>
                        </tr>
                    </thead>
                    <tbody id="customersTableList"></tbody>
                </table>
            </div>
        </div>

        <div class="row d-block d-md-none" id="customersCardList"></div>
    </div>

    <div class="modal fade" id="customerModal" tabindex="-1" aria-labelledby="customerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="customerModalLabel">د مشتری معلومات</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="tailorForm">
                        <input type="hidden" id="editIndex">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label>نوم</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="col-md-4">
                                <label>تلیفون شمیره</label>
                                <input type="text" class="form-control" id="phone" required>
                            </div>
                            <h5 class="mt-3">کمیس اندازه</h5>
                            <div class="col-md-3 border-radius"><label></label><input type="number" class="form-control"
                                    id="shirtSdrees" required placeholder="کمیس"></div><br>
                            <div class="col-md-3"><label></label><input type="number" class="form-control"
                                    id="shirtShoulder" required placeholder="شانه"></div>
                            <div class="col-md-3"><label></label><input type="number" class="form-control"
                                    id="shirtSleeve" required placeholder="لستوړی"></div>
                            <div class="col-md-3"><label></label><input type="number" class="form-control"
                                    id="shirtChest" required placeholder="ځیکر"></div>

                            <div class="col-md-3 text-center"><label></label><input type="number" class="form-control"
                                    id="pantWaist" required placeholder="پایځه"></div>
                            <div class="col-md-3"><label> </label><input type="number" class="form-control"
                                    id="pantLength" required placeholder="پرتوګ"></div>
                            <div class="col-md-3"><label></label><input type="number" class="form-control" id="pantNeck"
                                    required placeholder="غاړه"></div>
                            <div class="col-md-6"><label></label><input type="date" class="form-control"
                                    id="deliveryDate" required placeholder=" راوړلو تاریخ"></div>
                            <div class="col-md-6"><label></label><input type="text" class="form-control" id="daysToMake"
                                    required placeholder="دجو‌ړولو‌‌‌ډیزاین"></div>

                            <div class="col-md-3"><label></label><input type="number" class="form-control" id="price"
                                    required placeholder="قیمت"></div>
                            <button type="submit" class="btn btn-success w-60 mt-3">راجستر کړئ</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="bootstrap.bundle.min.js"></script>
    <script>
        const form = document.getElementById('tailorForm');
        const searchInput = document.getElementById('searchInput');
        const clearStorageBtn = document.getElementById('clearStorageBtn');
        let modal = new bootstrap.Modal(document.getElementById('customerModal'));

        let customers = JSON.parse(localStorage.getItem('customers')) || [];

        // --- Render List ---
        function renderList(data = customers) {
            const tableBody = document.getElementById('customersTableList');
            const cardContainer = document.getElementById('customersCardList');
            tableBody.innerHTML = '';
            cardContainer.innerHTML = '';
            const today = new Date();

            data.forEach((cust, index) => {
                const deliveryDate = new Date(cust.deliveryDate);
                const daysLeft = Math.ceil((deliveryDate - today) / (1000 * 60 * 60 * 24));
                const alertText = daysLeft <= 10 ? '  ' : '';

                // --- جدول ---
                const tr = document.createElement('tr');
                if (daysLeft <= 10) tr.classList.add('near-delivery');
                tr.innerHTML = `
            <td>${cust.name}</td>
            <td>${cust.phone}</td>
            <td>${cust.deliveryDate} <span class="alert-icon">${alertText}</span></td>
            <td>${cust.price}</td>
            <td>
                <button class="btn btn-sm btn-info" onclick="toggleTableCollapse('tableCollapse${index}')">نور جزیات</button>
                <button class="btn btn-sm btn-warning ms-1" onclick="editCustomer(${index})">ایډیټ</button>
                <button class="btn btn-sm btn-danger ms-1" onclick="deleteCustomer(${index})">حذف</button>
            </td>
        `;
                tableBody.appendChild(tr);

                const trCollapse = document.createElement('tr');
                trCollapse.classList.add('collapse');
                trCollapse.id = `tableCollapse${index}`;
                trCollapse.innerHTML = `
            <td colspan="5">
                <h6>   دکالو اندازه:</h6>
              كميس: ${cust.shirtSdrees} <br>  شانه: ${cust.shirtShoulder} <br> لستوړی: ${cust.shirtSleeve} <br> ځیکر: ${cust.shirtChest} <br>
                 
                پایڅی: ${cust.pantWaist} <br> پرتوګ: ${cust.pantLength} <br>غاړه: ${cust.pantNeck} <br>
                <strong>     :</strong> ${cust.daysToMake}  
            </td>
        `;
                tableBody.appendChild(trCollapse);

                // --- کارتونه موبایل ---
                const card = document.createElement('div');
                card.classList.add('col-12', 'mb-3');
                const collapseId = `collapseCard${index}`;
                card.innerHTML = `
            <div class="card shadow-sm ${daysLeft <= 10 ? 'near-delivery' : ''}">
                <div class="card-body">
                    <h5 class="card-title">${cust.name}</h5>
                    <p><strong>تلیفون:</strong> ${cust.phone}</p>
                    <p><strong>راوړلو تاریخ:</strong> ${cust.deliveryDate} <span class="alert-icon">${alertText}</span></p>
                    <p><strong>قیمت:</strong> ${cust.price}</p>
                    <button class="btn btn-sm btn-info mb-2" onclick="toggleCardCollapse('${collapseId}')">نور جزیات</button>
                    <div class="collapse" id="${collapseId}">
                        <h6>کمیس اندازه:</h6>
                       كميس: ${cust.shirtSdrees} شانه: ${cust.shirtShoulder}, لستوړی: ${cust.shirtSleeve}, ځیکر: ${cust.shirtChest} <br>
                         
                        
                        پایڅی: ${cust.pantWaist}, اوږدوالی: ${cust.pantLength}, غاړه: ${cust.pantNeck} <br>
                        <strong>کالو‌ډیزاین </strong> ${cust.daysToMake} 
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                        <button class="btn btn-sm btn-warning" onclick="editCustomer(${index})">ایډیټ</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${index})">حذف</button>
                    </div>
                </div>
            </div>
        `;
                cardContainer.appendChild(card);
            });
        }

        // --- Collapse toggle functions ---
        function toggleCardCollapse(id) {
            document.querySelectorAll('#customersCardList .collapse').forEach(el => {
                if (el.id !== id) bootstrap.Collapse.getInstance(el)?.hide();
            });
            const target = document.getElementById(id);
            let bsTarget = bootstrap.Collapse.getInstance(target);
            if (!bsTarget) bsTarget = new bootstrap.Collapse(target, { toggle: true });
            else bsTarget.toggle();
        }

        function toggleTableCollapse(id) {
            document.querySelectorAll('#customersTableList .collapse').forEach(el => {
                if (el.id !== id) bootstrap.Collapse.getInstance(el)?.hide();
            });
            const target = document.getElementById(id);
            let bsTarget = bootstrap.Collapse.getInstance(target);
            if (!bsTarget) bsTarget = new bootstrap.Collapse(target, { toggle: true });
            else bsTarget.toggle();
        }

        // --- Form submit ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const editIndex = document.getElementById('editIndex').value;
            const newCustomer = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                shirtSdrees: document.getElementById('shirtSdrees').value,
                shirtShoulder: document.getElementById('shirtShoulder').value,
                shirtSleeve: document.getElementById('shirtSleeve').value,
                shirtChest: document.getElementById('shirtChest').value,
                pantWaist: document.getElementById('pantWaist').value,
                pantLength: document.getElementById('pantLength').value,
                pantNeck: document.getElementById('pantNeck').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                daysToMake: document.getElementById('daysToMake').value,
                price: document.getElementById('price').value
            };
            if (editIndex === '') customers.push(newCustomer);
            else customers[editIndex] = newCustomer;
            localStorage.setItem('customers', JSON.stringify(customers));
            form.reset();
            document.getElementById('editIndex').value = '';
            modal.hide();
            renderList();
        });

        // --- Edit & Delete ---
        function editCustomer(index) {
            const cust = customers[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('name').value = cust.name;
            document.getElementById('phone').value = cust.phone;
            document.getElementById('shirtSdrees').value = cust.shirtSdrees;
            document.getElementById('shirtShoulder').value = cust.shirtShoulder;
            document.getElementById('shirtSleeve').value = cust.shirtSleeve;
            document.getElementById('shirtChest').value = cust.shirtChest;
            document.getElementById('pantWaist').value = cust.pantWaist;
            document.getElementById('pantLength').value = cust.pantLength;
            document.getElementById('pantNeck').value = cust.pantNeck;
            document.getElementById('deliveryDate').value = cust.deliveryDate;
            document.getElementById('daysToMake').value = cust.daysToMake;
            document.getElementById('price').value = cust.price;
            modal.show();
        }

        function deleteCustomer(index) {
            if (confirm('ایا تاسو ډاډه یاست؟')) {
                customers.splice(index, 1);
                localStorage.setItem('customers', JSON.stringify(customers));
                renderList();
            }
        }

        // --- Clear All ---
        clearStorageBtn.addEventListener('click', () => {
            if (confirm('ایا تاسو ټول مشتریان حذف کول غواړئ؟')) {
                customers = [];
                localStorage.removeItem('customers');
                renderList();
            }
        });

        // --- Search ---
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase();
            const filtered = customers.filter(cust => cust.name.toLowerCase().includes(query) || cust.phone.includes(query));
            renderList(filtered);
        });

        // لومړۍ بار رینډر
        renderList();

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>