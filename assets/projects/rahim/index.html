<!doctype html>
<html lang="ps">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø¯ Ø¯ÙˆØ§Ø®Ø§Ù†Ùˆ Ú©Ù†Ù¼Ø±ÙˆÙ„ Ø³ÛŒØ³Ù¼Ù…</title>

  <link rel="stylesheet" href="./bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

<body class="container py-4">

  <h2 class="text-center mb-4">ğŸ’Š  Ø¯ Ø¯ÙˆØ§Ø®Ø§Ù†Ùˆ Ú©Ù†Ù¼Ø±ÙˆÙ„ Ø³ÛŒØ³Ù¼Ù…</h2>

<!-- Ø¯ Ø¯Ø±Ù…Ù„Ùˆ Ø«Ø¨Øª -->
<div class="card">
<div class="card-header bg-primary text-white text-center">Ø¯Ø±Ù…Ù„ Ø«Ø¨Øª Ú©Ú“Ø¦</div>
<div class="card-body">
<div class="row g-3">
  <div class="col-md-2"><input id="medName" type="text" class="form-control" placeholder="Ø¯ Ø¯Ø±Ù…Ù„ Ù†ÙˆÙ…"></div>
  <div class="col-md-2"><input id="buyPrice" type="number" class="form-control" placeholder="Ø¯ Ø§Ø®ÛŒØ³ØªÙ„Ùˆ Ù‚ÛŒÙ…Øª"></div>
  <div class="col-md-2"><input id="sellPriceInput" type="number" class="form-control" placeholder="Ø¯ Ù¾Ù„ÙˆØ±Ù„Ùˆ Ù‚ÛŒÙ…Øª"></div>
  <div class="col-md-2"><input id="quantity" type="text" class="form-control" placeholder="Ø§Ù†Ø¯Ø§Ø²Ù‡ (Ù…Ø«Ø§Ù„: 20 Ú©Ø§Ø±Ù¼Ù†Ù‡)"></div>
  <div class="col-md-2"><input id="expiry" type="date" class="form-control"></div>
  <div class="col-md-2">
    <input id="medCountry" list="countryList" type="text" class="form-control" placeholder="Ø¯ ØªÙˆÙ„ÛŒØ¯ Ù‡ÛŒÙˆØ§Ø¯">
    <datalist id="countryList">
      <option value="USA"><option value="Germany"><option value="Switzerland"><option value="India">
      <option value="UK"><option value="France"><option value="Japan"><option value="Italy">
      <option value="Canada"><option value="China"><option value="Belgium"><option value="Australia">
      <option value="Netherlands"><option value="Brazil"><option value="South Korea"><option value="Israel">
      <option value="Denmark"><option value="Sweden"><option value="Austria"><option value="Finland">
    </datalist>
  </div>
  <div class="col-md-2"><button class="btn btn-success w-100" onclick="addMedicine()">Ø«Ø¨Øª</button></div>
</div>
</div>
</div>

<!-- Ø¯ Ù¾Ù„ÙˆØ± Ø¨Ø±Ø®Ù‡ -->
<div class="card">
<div class="card-header bg-warning text-dark text-center">Ø¯Ø±Ù…Ù„ ÙˆÙ¾Ù„ÙˆØ±Ø¦</div>
<div class="card-body">
<div class="row g-3">
  <div class="col-md-3">
    <input id="sellMed" list="medicineList" type="text" class="form-control" placeholder="Ø¯ Ø¯Ø±Ù…Ù„ Ù†ÙˆÙ…" oninput="autoFillPrice()">
    <datalist id="medicineList"></datalist>
  </div>
  <div class="col-md-2"><input id="sellPrice" type="number" class="form-control" placeholder="Ø¯ Ù¾Ù„ÙˆØ± Ù‚ÛŒÙ…Øª"></div>
  <div class="col-md-2"><input id="sellQty" type="text" class="form-control" placeholder="Ø§Ù†Ø¯Ø§Ø²Ù‡ (Ù…Ø«Ø§Ù„: 5 Ú©Ø§Ø±Ù¼Ù†Ù‡)"></div>
  <div class="col-md-3"><input id="customer" type="text" class="form-control" placeholder="Ø¯ Ù…Ø´ØªØ±ÛŒ Ù†ÙˆÙ…"></div>
  <div class="col-md-2"><button class="btn btn-primary w-100" onclick="sellMedicine()">Ù¾Ù„ÙˆØ±</button></div>
</div>
</div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ÙˆÙ†Ù‡ Ø§Ùˆ Ù„Ù¼ÙˆÙ† -->
<div class="row mb-3">
<div class="col-md-6">
<input id="searchMed" type="text" class="form-control" placeholder="Ù¾Ù‡ Ø¯Ø±Ù…Ù„Ùˆ Ú©Û Ù„Ù¼ÙˆÙ† ÙˆÚ©Ú“Ø¦..." onkeyup="searchMedicine()">
</div>
<div class="col-md-6">
<input id="searchSell" type="text" class="form-control" placeholder="Ù¾Ù‡ Ù¾Ù„ÙˆØ±Ù„ Ø´ÙˆÙˆ Ø¯Ø±Ù…Ù„Ùˆ Ú©Û Ù„Ù¼ÙˆÙ† ÙˆÚ©Ú“Ø¦..." onkeyup="searchSale()">
</div>
</div>

<div class="row">
<div class="col-md-6">
<div class="card">
<div class="card-header bg-success text-white text-center">Ø¯ Ø±Ø§ØºÙ„Ùˆ Ø¯Ø±Ù…Ù„Ùˆ Ù„ÛŒØ³Øª</div>
<div class="card-body">
<table class="table table-bordered text-center">
  <thead>
    <tr><th>Ù†ÙˆÙ…</th><th>Ø§Ø®ÛŒØ³ØªÙ„Ùˆ Ù‚ÛŒÙ…Øª</th><th>Ù¾Ù„ÙˆØ±Ù„Ùˆ Ù‚ÛŒÙ…Øª</th><th>Ø§Ù†Ø¯Ø§Ø²Ù‡</th><th>Ø®ØªÙ…ÛØ¯Ùˆ Ù†ÛÙ¼Ù‡</th><th>ØªÙˆÙ„ÛŒØ¯ Ù‡ÛŒÙˆØ§Ø¯</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
  </thead>
  <tbody id="medTable"></tbody>
</table>
</div>
</div>
</div>

<div class="col-md-6">
<div class="card">
<div class="card-header bg-info text-white text-center">Ø¯ Ù¾Ù„ÙˆØ±Ù„ Ø´ÙˆÙˆ Ø¯Ø±Ù…Ù„Ùˆ Ù„ÛŒØ³Øª</div>
<div class="card-body">
<table class="table table-bordered text-center">
  <thead>
    <tr><th>Ù†ÙˆÙ…</th><th>Ù‚ÛŒÙ…Øª</th><th>Ø§Ù†Ø¯Ø§Ø²Ù‡</th><th>Ù…Ø´ØªØ±ÛŒ</th><th>Ù†ÛÙ¼Ù‡</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
  </thead>
  <tbody id="sellTable"></tbody>
</table>
</div>
</div>
</div>
</div>

<!-- Ø±Ø§Ù¾ÙˆØ± -->
<div class="card">
<div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
  <span>ğŸ“Š Ø§Ø­ØµØ§Ø¦ÛŒÙ‡ Ø§Ùˆ Ø±Ø§Ù¾ÙˆØ±</span>
  <div>
    <button class="btn btn-light btn-sm btn-export" onclick="exportExcel()">ğŸ“— Excel ØªÙ‡</button>
    <button class="btn btn-light btn-sm btn-export" onclick="exportPDF()">ğŸ“„ PDF ØªÙ‡</button>
  </div>
</div>
<div class="card-body text-center">
  <p>ğŸ’° Ø¯ Ù¼ÙˆÙ„Ùˆ Ø±Ø§ØºÙ„Ùˆ Ø¯Ø±Ù…Ù„Ùˆ Ù¼ÙˆÙ¼Ù„ Ù‚ÛŒÙ…Øª (Ø³Ø±Ù…Ø§ÛŒÙ‡): <strong id="totalBuy">0</strong> Ø§ÙØºØ§Ù†ÛŒ</p>
  <p>ğŸ’µ Ø¯ Ù¾Ù„ÙˆØ±Ù„ Ø´ÙˆÙˆ Ø¯Ø±Ù…Ù„Ùˆ Ù¼ÙˆÙ¼Ù„ Ù‚ÛŒÙ…Øª: <strong id="totalSell">0</strong> Ø§ÙØºØ§Ù†ÛŒ</p>
  <p>ğŸ“¦ Ø¯ Ù¾Ù„ÙˆØ±Ù„ Ø´ÙˆÙˆ Ø¯Ø±Ù…Ù„Ùˆ Ø§Ù†Ø¯Ø§Ø²Ù‡: <strong id="totalQty">0</strong></p>
  <p>ğŸ“ˆ Ú«Ù¼Ù‡ ÛŒØ§ ØªØ§ÙˆØ§Ù†: <strong id="profit">0</strong> Ø§ÙØºØ§Ù†ÛŒ</p>
  <hr>
  <h5 class="text-primary">ğŸ“… Ø¯ Ù†Ù† ÙˆØ±ÚÛ Ø±Ø§Ù¾ÙˆØ±</h5>
  <p>ğŸ§¾ Ø¯ Ù†Ù† ÙˆØ±ÚÛ Ù¾Ù„ÙˆØ±: <strong id="todaySell">0</strong> Ø§ÙØºØ§Ù†ÛŒ</p>
  <p>ğŸ“¦ Ø¯ Ù†Ù† ÙˆØ±ÚÛ Ù¾Ù„ÙˆØ±Ù„ Ø´ÙˆÙŠ Ø¯Ø±Ù…Ù„: <strong id="todayQty">0</strong></p>
  <p>ğŸ“ˆ Ø¯ Ù†Ù† ÙˆØ±ÚÛ Ú«Ù¼Ù‡: <strong id="todayProfit">0</strong> Ø§ÙØºØ§Ù†ÛŒ</p>
  <p>ğŸ“‰ Ø¯ Ù†Ù† ÙˆØ±ÚÛ ØªØ§ÙˆØ§Ù†: <strong id="todayLoss">0</strong> Ø§ÙØºØ§Ù†ÛŒ</p>
</div>
</div>

<!-- Ø±Ø³ÛŒØ¯ -->
<div id="invoice" class="invoice card p-4">
<h4 class="text-center mb-3">ğŸ§¾ Ø¯ Ù¾Ù„ÙˆØ± Ø±Ø³ÛŒØ¯</h4>
<p><strong>Ù…Ø´ØªØ±ÛŒ:</strong> <span id="invCustomer"></span></p>
<p><strong>Ø¯Ø±Ù…Ù„:</strong> <span id="invName"></span></p>
<p><strong>Ø§Ù†Ø¯Ø§Ø²Ù‡:</strong> <span id="invQty"></span></p>
<p><strong>Ù‚ÛŒÙ…Øª:</strong> <span id="invPrice"></span> Ø§ÙØºØ§Ù†ÛŒ</p>
<p><strong>Ù¼ÙˆÙ„:</strong> <span id="invTotal"></span> Ø§ÙØºØ§Ù†ÛŒ</p>
<button class="btn btn-outline-secondary w-100 mt-3" onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾</button>
</div>

<script>
// ==== Data ====
let medicines = JSON.parse(localStorage.getItem('medicines')) || [];
let sales = JSON.parse(localStorage.getItem('sales')) || [];

// ==== Save ====
function saveData() {
  localStorage.setItem('medicines', JSON.stringify(medicines));
  localStorage.setItem('sales', JSON.stringify(sales));
}

// ==== Add Medicine ====
function addMedicine() {
  const name = medName.value.trim();
  const buyP = parseFloat(buyPrice.value) || 0;
  const sellP = parseFloat(sellPriceInput.value) || 0;
  const qty = quantity.value.trim();
  const expiryDate = expiry.value;
  const country = medCountry.value.trim();
  if (!name || buyP <= 0 || sellP <= 0 || !qty || !expiryDate || !country) return alert('Ù¼ÙˆÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙ„ÛŒÚ©Ø¦!');
  
  medicines.push({ name, buyPrice: buyP, sellPrice: sellP, qty, expiry: expiryDate, country });
  saveData(); updateMedTable(); updateMedicineDatalist(); updateTotals();
  medName.value = buyPrice.value = sellPriceInput.value = quantity.value = expiry.value = medCountry.value = '';
}

// ==== Auto Fill Price ====
function autoFillPrice() {
  const name = sellMed.value.trim();
  const med = medicines.find(m => m.name === name);
  if (med) sellPrice.value = med.sellPrice;
}

// ==== Sell Medicine ====
function sellMedicine() {
  const name = sellMed.value.trim();
  let price = parseFloat(sellPrice.value) || 0;
  const qty = sellQty.value.trim();
  const customerName = customer.value.trim();
  if (!name || price <= 0 || !qty || !customerName) return alert('Ù¼ÙˆÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙ„ÛŒÚ©Ø¦!');

  const medIndex = medicines.findIndex(m => m.name === name);
  if (medIndex === -1) return alert('Ø¯Ø§ Ø¯Ø±Ù…Ù„ Ø´ØªÙˆÙ† Ù†Ù„Ø±ÙŠ!');

  const numericQty = parseInt(qty);
  const stockQty = parseInt(medicines[medIndex].qty) || 0;
  if (stockQty < numericQty) return alert('Ù¾Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ú©Û Ø¯ÙˆÙ…Ø±Ù‡ Ø¯Ø±Ù…Ù„ Ù†Ø´ØªÙ‡!');

  price = price || medicines[medIndex].sellPrice;
  const remainingQty = stockQty - numericQty;
  medicines[medIndex].qty = remainingQty > 0 ? remainingQty + ' ' + medicines[medIndex].qty.split(' ').slice(1).join('') : '';
  if (remainingQty <= 0) medicines.splice(medIndex, 1);

  const today = new Date().toISOString().split('T')[0];
  sales.push({ name, price, qty, customer: customerName, date: today, buyPrice: medicines[medIndex]?.buyPrice || 0 });
  saveData(); updateMedTable(); updateSellTable(); updateMedicineDatalist();
  updateTotals(); updateTodayReport();
  showInvoice(customerName, name, qty, price);
  sellMed.value = sellPrice.value = sellQty.value = customer.value = '';
}

// ==== Update Tables ====
function updateMedTable() {
  medTable.innerHTML = medicines.map((m, i) =>
    `<tr>
      <td>${m.name}</td><td>${m.buyPrice}</td><td>${m.sellPrice}</td><td>${m.qty}</td><td>${m.expiry}</td><td>${m.country}</td>
      <td><button class='btn btn-sm btn-outline-primary' onclick='editMedicine(${i})'>Ø§ÛŒÚ‰ÛŒÙ¼</button>
      <button class='btn btn-sm btn-outline-danger' onclick='deleteMedicine(${i})'>Ú‰ÛŒÙ„ÛŒÙ¼</button></td>
    </tr>`).join('');
}

function updateSellTable() {
  sellTable.innerHTML = sales.map((s, i) =>
    `<tr>
      <td>${s.name}</td><td>${s.price}</td><td>${s.qty}</td><td>${s.customer}</td><td>${s.date}</td>
      <td><button class='btn btn-sm btn-outline-secondary' onclick='showInvoice("${s.customer}","${s.name}","${s.qty}",${s.price})'>Ø±Ø³ÛŒØ¯</button>
      <button class='btn btn-sm btn-outline-danger' onclick='deleteSale(${i})'>Ú‰ÛŒÙ„ÛŒÙ¼</button></td>
    </tr>`).join('');
}

// ==== Edit/Delete ====
function editMedicine(i) {
  const med = medicines[i];
  medName.value = med.name; buyPrice.value = med.buyPrice; sellPriceInput.value = med.sellPrice;
  quantity.value = med.qty; expiry.value = med.expiry; medCountry.value = med.country;
  medicines.splice(i, 1); saveData(); updateMedTable(); updateMedicineDatalist();
}

function deleteMedicine(i) {
  if (confirm('Ø¢ÛŒØ§ Ú‰Ø§Ú‰Ù‡ ÛŒØ§Ø³ØªØŸ')) { medicines.splice(i, 1); saveData(); updateMedTable(); updateTotals(); updateMedicineDatalist(); }
}
function deleteSale(i) {
  if (confirm('Ø¢ÛŒØ§ Ú‰Ø§Ú‰Ù‡ ÛŒØ§Ø³ØªØŸ')) { sales.splice(i, 1); saveData(); updateSellTable(); updateTotals(); updateTodayReport(); }
}

// ==== Totals ====
function updateTotals() {
  const totalBuyVal = medicines.reduce((sum, m) => sum + (parseFloat(m.buyPrice) * (parseInt(m.qty)||0)), 0);
  const totalSellVal = sales.reduce((sum, s) => sum + s.price * (parseInt(s.qty)||0), 0);
  const totalQtyVal = sales.reduce((sum, s) => sum + (parseInt(s.qty)||0), 0);
  const profitVal = totalSellVal - totalBuyVal;
  totalBuy.textContent = totalBuyVal.toFixed(2
);
  totalSell.textContent = totalSellVal.toFixed(2);
  totalQty.textContent = totalQtyVal;
  profit.textContent = profitVal.toFixed(2);
}

function updateTodayReport() {
  const today = new Date().toISOString().split('T')[0];
  const todaySales = sales.filter(s => s.date === today);
  const totalToday = todaySales.reduce((sum, s) => sum + s.price * (parseInt(s.qty)||0), 0);
  const qtyToday = todaySales.reduce((sum, s) => sum + (parseInt(s.qty)||0), 0);
  const costToday = todaySales.reduce((sum, s) => sum + s.buyPrice * (parseInt(s.qty)||0), 0);
  todaySell.textContent = totalToday.toFixed(2);
  todayQty.textContent = qtyToday;
  todayProfit.textContent = Math.max(0, totalToday - costToday).toFixed(2);
  todayLoss.textContent = Math.max(0, costToday - totalToday).toFixed(2);
}

function showInvoice(customer, name, qty, price) {
  invCustomer.textContent = customer;
  invName.textContent = name;
  invQty.textContent = qty;
  invPrice.textContent = price.toFixed(2);
  invTotal.textContent = (parseInt(qty)||0 * price).toFixed(2);
  invoice.style.display = 'block';
  window.scrollTo(0, document.body.scrollHeight);
}

function updateMedicineDatalist() {
  medicineList.innerHTML = medicines.map(m => `<option value="${m.name}">`).join('');
}

// ==== Search Functions ====
function searchMedicine() {
  const filter = searchMed.value.trim().toLowerCase();
  medTable.innerHTML = medicines
    .map((m, i) => ({ ...m, index: i }))
    .filter(m => m.name.toLowerCase().includes(filter))
    .map(m => `
      <tr>
        <td>${m.name}</td>
        <td>${m.buyPrice}</td>
        <td>${m.sellPrice}</td>
        <td>${m.qty}</td>
        <td>${m.expiry}</td>
        <td>${m.country}</td>
        <td>
          <button class='btn btn-sm btn-outline-primary' onclick='editMedicine(${m.index})'>Ø§ÛŒÚ‰ÛŒÙ¼</button>
          <button class='btn btn-sm btn-outline-danger' onclick='deleteMedicine(${m.index})'>Ú‰ÛŒÙ„ÛŒÙ¼</button>
        </td>
      </tr>
    `).join('');
}

function searchSale() {
  const filter = searchSell.value.trim().toLowerCase();
  sellTable.innerHTML = sales
    .map((s, i) => ({ ...s, index: i }))
    .filter(s => {
      const nameMatch = s.name.toLowerCase().includes(filter);
      const customerMatch = s.customer.toLowerCase().includes(filter);
      const qtyMatch = s.qty.toLowerCase().includes(filter);
      return nameMatch || customerMatch || qtyMatch;
    })
    .map(s => `
      <tr>
        <td>${s.name}</td>
        <td>${s.price}</td>
        <td>${s.qty}</td>
        <td>${s.customer}</td>
        <td>${s.date}</td>
        <td>
          <button class='btn btn-sm btn-outline-secondary' onclick='showInvoice("${s.customer}","${s.name}","${s.qty}",${s.price})'>Ø±Ø³ÛŒØ¯</button>
          <button class='btn btn-sm btn-outline-danger' onclick='deleteSale(${s.index})'>Ú‰ÛŒÙ„ÛŒÙ¼</button>
        </td>
      </tr>
    `).join('');
}

// ==== Export Functions ====
function exportExcel() {
  const wb = XLSX.utils.book_new();
  const ws1 = XLSX.utils.json_to_sheet(medicines);
  const ws2 = XLSX.utils.json_to_sheet(sales);
  XLSX.utils.book_append_sheet(wb, ws1, "Ø¯Ø±Ù…Ù„");
  XLSX.utils.book_append_sheet(wb, ws2, "Ù¾Ù„ÙˆØ±");
  XLSX.writeFile(wb, "Pharmacy_Report.xlsx");
}

function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Ø¯ÙˆØ§Ø®Ø§Ù†Ùˆ ÙˆØ±ÚÙ†ÛŒ Ø±Ø§Ù¾ÙˆØ±", 10, 10);
  doc.text(`Ù¼ÙˆÙ„ Ù¾Ù„ÙˆØ±: ${totalSell.textContent} AFN`, 10, 20);
  doc.text(`Ú«Ù¼Ù‡/ØªØ§ÙˆØ§Ù†: ${profit.textContent} AFN`, 10, 30);
  doc.text(`Ù†Ù† ÙˆØ±Ú Ù¾Ù„ÙˆØ±: ${todaySell.textContent} AFN`, 10, 40);
  doc.text(`Ù†Ù† Ù¾Ù„ÙˆØ±Ù„ Ø´ÙˆÙŠ Ø¯Ø±Ù…Ù„: ${todayQty.textContent}`, 10, 50);
  doc.text(`Ù†Ù† ÙˆØ±Ú Ú«Ù¼Ù‡: ${todayProfit.textContent} AFN`, 10, 60);
  doc.text(`Ù†Ù† ÙˆØ±Ú ØªØ§ÙˆØ§Ù†: ${todayLoss.textContent} AFN`, 10, 70);
  doc.save("Pharmacy_Daily_Report.pdf");
}

// ==== Initialize ====
updateMedTable(); 
updateSellTable(); 
updateMedicineDatalist(); 
updateTotals(); 
updateTodayReport();
   
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</body>
</html>